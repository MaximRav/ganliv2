<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/navibar.css" />
    <link rel="stylesheet" href="/ganTamp.css" />
    <title>הדרדסים</title>
</head>

<body>
    <header>
        <bar>
            <ul>
                <li><a href="/selfPage" id="selfPageLink">אזור אישי</a></li>
                <li><a href="/ganimlist.html">גנים</a></li>
                <li><a href="/aboutPage.html">אודות</a></li>
                <li><a href="/HomeLog.html">בית</a></li>
                <li><a href="/HomeLog.html" class="logo">גן-לי</a></li>
                <li>
                    <a href="/logout" class="login" id="logoutLink">התנתקות</a>
                </li>
            </ul>
        </bar>
    </header>
    <main class="inner">
        <section class="frame-group">
            <div class="frame-container">
                <div class="frame-div">
                    <div class="frame-parent1">
                        <div class="rectangle-group">
                            <div class="frame-item"></div>
                            <div class="container">
                                <div class="div5">:התראות מן הגן</div>
                            </div>
                            <div class="div6">
                                <p class="p"></p>
                            </div>
                        </div>
                        <div class="frame-parent2">
                            <div class="rectangle-container">
                                <div class="frame-inner"></div>
                                <div class="div7">:חזון הגן</div>
                                <div class="div8">
                                    <p class="p2">בגן הילדים שלנו, אנו מחויבים ליצירת סביבה חמה, מגבית ומעוררת השראה
                                        לצמיחה של כל ילד. חזוננו הוא לספק לילדים חוויות למידה מגוונות וחוויות חברתיות
                                        רגשיות בריאות, המקנות להם כלים להתפתחות מלאה ושלמה.

                                        בגן שלנו, כל ילד יקבל תמיכה אישית והתעניינות מצוינת בצרכיו הפרטיים. אנו נקדם
                                        ערכים של כבוד, אחריות ושיתוף פעולה, ונעודד יכולת יצירתית וחשיבה גמישה.

                                        הגן יהיה מקום שבו ילדים לומדים לפתח אומץ וביטחון בעצמם דרך חוויות רגשיות
                                        וחברתיות. נשתדל ליצור קשר אמיתי ועמוק עם ההורים כפרטנרים בתהליך החינוך, על מנת
                                        לקדם את רכישת הילדים בכישורים ובערכים הדרושים להצלחה בחיים.</p>
                                </div>
                            </div>
                            <div class="rectangle-parent1">
                                <div class="rectangle-div"></div>
                                <div class="div9">:עקרונות הגן</div>
                                <div class="div10">
                                    <ol class="ol">
                                        <li class="li">ביטחון ובריאות הילדים: אנו מאמינים ביצירת סביבה בטוחה ובריאה
                                            לילדים. אנו שמים דגש רב על תנאי בטיחות בגן ועל ניהול רגיל של בריאות הילדים.

                                            פיתוח רגשי וחברתי: אנו עוסקים בפיתוח יכולות רגשיות וחברתיות של הילדים. נעזר
                                            בפעילויות קבוצתיות ותקשורת בין אישית לקידום יכולות הקשר וההתמקצעות</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="frame-parent3">
                    <div class="rectangle-parent2">
                        <div class="frame-child1"></div>
                        <div class="div10">
                            <span>שם הגן:</span>
                            <span class="span">הדרדסים</span>
                        </div>
                        <div class="div11">
                            <span>שם הגננת:</span>
                            <span class="span">יוליה פוטפנקו</span>
                        </div>
                        <div class="div13">
                            <span>שנת הקמה:</span>
                            <span class="span2">2001</span>
                        </div>
                        <div class="div14">
                            <span>אופי הגן:</span>
                            <span class="span3">דתי</span>
                        </div>
                        <div class="div16">
                            <span>מספר ילדים:</span>
                            <span class="span5">1</span>
                        </div>
                        <div class="div17">
                            <span>מחיר:</span>
                            <span class="span6">2000</span>
                        </div>
                        <div class="div19">
                            <p class="p4">
                                <span class="span8">שעות פעילות:</span>
                                <span> </span>
                            </p>
                            <p class="p5">7-17</p>
                        </div>
                    </div>
                    <iframe
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3411.3290961397697!2d34.79699821964609!3d31.23931179484147!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x1502661718ca7761%3A0xd979e74e93889e19!2z15TXk9eh15QgMTksINeR15DXqCDXqdeR16I!5e0!3m2!1siw!2sil!4v1712701729565!5m2!1siw!2sil"
                        width="400" height="400" style="border:0;" allowfullscreen="" loading="lazy"
                        referrerpolicy="no-referrer-when-downgrade"></iframe>
                </div>
            </div>
            <div class="rectangle-parent3">
                <div class="rectangle-parent4">
                    <div class="frame-child3"></div>
                    <div class="frame-parent4" id="reviewsContainer">
                        <!-- Reviews will be dynamically added here -->
                    </div>
                    <div class="frame">
                        <div class="div23">הוסף ביקורת</div>
                        <form id="reviewForm">
                            <textarea id="reviewText" rows="4" cols="50"></textarea>
                            <button type="submit">שלח</button>
                        </form>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <!--REPLACE_WITH_ADMIN_BUTTONS-->
</body>
<script>
    // Get the user's role from the server
    fetch('/profile')
        .then(response => response.json())
        .then(data => {
            const userRole = data.role;
            const selfPageLink = document.getElementById('selfPageLink');

            // Update the selfPageLink based on the user's role
            if (userRole === 'הורה') {
                selfPageLink.href = '/selfPageP.html';
            } else if (userRole === 'גננת') {
                selfPageLink.href = '/selfPageG.html';
            } else if (userRole === 'admin') {
                selfPageLink.href = '/selfPageA.html';
            }

            // Check if the user is an admin
            if (userRole === 'admin') {
                // Inject the edit and delete buttons for admin users
                const adminButtonsContainer = document.createElement('div');
                adminButtonsContainer.innerHTML = `

                            `;
                document.body.appendChild(adminButtonsContainer);
            }
        })
        .catch(error => {
            console.error('Error fetching user role:', error);
        });

    // Function to edit a gan
    function editGan(ganId) {
        window.location.href = `/editGan.html?ganId=${ganId}`;
    }

    // Function to delete a gan
    function deleteGan(ganId) {
        if (confirm('האם אתה בטוח שברצונך למחוק את הגן?')) {
            fetch(`/gans/${ganId}`, { method: 'DELETE' })
                .then(response => {
                    if (response.ok) {
                        alert('הגן נמחק בהצלחה');
                        window.location.href = '/ganimlist.html';
                    } else {
                        alert('שגיאה במחיקת הגן');
                    }
                })
                .catch(error => {
                    console.error('Error deleting gan:', error);
                    alert('שגיאה במחיקת הגן');
                });
        }
    }

    function fetchAndDisplayReviews(ganName) {
        fetch(`/gans/${ganName}`)
            .then(response => response.json())
            .then(gan => {
                const reviewsContainer = document.getElementById('reviewsContainer');
                reviewsContainer.innerHTML = '';
                gan.reviews.forEach(review => {
                    const reviewDiv = document.createElement('div');
                    reviewDiv.classList.add('review');
                    const authorSpan = document.createElement('span');
                    authorSpan.textContent = `${review.author}: `;
                    reviewDiv.appendChild(authorSpan);
                    const reviewText = document.createElement('p');
                    reviewText.textContent = review.text;
                    reviewDiv.appendChild(reviewText);
                    reviewsContainer.appendChild(reviewDiv);
                });
            })
            .catch(error => {
                console.error('Error fetching reviews:', error);
            });
    }

    function addReview(ganName) {
        const reviewText = document.getElementById('reviewText').value.trim();
        if (reviewText) {
            fetch(`/gans/${ganName}/review`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ review: reviewText }),
                credentials: 'include'
            })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('Error adding review');
                    }
                })
                .then(updatedGan => {
                    document.getElementById('reviewText').value = '';
                    fetchAndDisplayReviews(ganName);
                })
                .catch(error => {
                    console.error('Error adding review:', error);
                    alert('שגיאה בהוספת הביקורת');
                });
        }
    }

    // Add event listener to the review form
    const reviewForm = document.getElementById('reviewForm');
    reviewForm.addEventListener('submit', event => {
        event.preventDefault();
        addReview('הדרדסים');
    });

    // Fetch and display reviews when the page loads
    fetchAndDisplayReviews('הדרדסים');

</script>

</html>